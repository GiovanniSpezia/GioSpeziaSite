<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>J.A.R.V.I.S | GioSpezia</title>
  <link rel="stylesheet" href="style.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Montserrat:wght@600&display=swap" rel="stylesheet"/>
  <link rel="icon" href="img/icon.png" type="image/png"/>

  <!-- ====== STILI SPECIFICI J.A.R.V.I.S ====== -->
  <style>
    /* Sezione principale */
    .jarvis-section{
      padding:100px 20px;
      background:linear-gradient(135deg,#fdfdfd,#f3f6fa);
      display:flex;flex-direction:column;align-items:center
    }

    /* Titolo nero con linea colorata */
    .jarvis-header{text-align:center;margin-bottom:50px;position:relative}
    .jarvis-header h2{
      font-size:3rem;font-family:'Montserrat',sans-serif;font-weight:700;color:#111;
      display:inline-block;margin-bottom:20px;position:relative
    }
    .jarvis-header h2::after{
      content:"";width:100px;height:5px;border-radius:3px;
      background-color: #007BFF;
      position:absolute;left:50%;bottom:-12px;transform:translateX(-50%);
      box-shadow:0 0 14px rgba(0,123,255,.35)
    }
    .jarvis-header p{color:#666;font-size:1.1rem;margin-top:10px}

    /* Chat box (glassmorphism) */
    .chat-box{
      width:100%;max-width:850px;height:520px;background:rgba(255,255,255,.75);
      backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);
      border-radius:20px;border:1px solid rgba(200,200,200,.5);
      box-shadow:0 12px 30px rgba(0,0,0,.12);
      display:flex;flex-direction:column;overflow:hidden;transition:.3s
    }
    .chat-box:hover{transform:translateY(-4px);box-shadow:0 16px 40px rgba(0,0,0,.15)}

    /* Area messaggi */
    .chat-messages{
      flex:1;padding:24px;overflow-y:auto;display:flex;flex-direction:column;gap:14px;scroll-behavior:smooth
    }
    .chat-messages::-webkit-scrollbar{width:8px}
    .chat-messages::-webkit-scrollbar-thumb{background:#c5c5c5;border-radius:10px}
    .chat-messages::-webkit-scrollbar-track{background:#f0f0f0}

    /* Bolle messaggi */
    .message{
      max-width:75%;padding:14px 18px;border-radius:18px;font-size:1rem;line-height:1.5;
      word-wrap:break-word;animation:fadeIn .3s ease;position:relative
    }
    .user-msg{
      align-self:flex-end;color:#fff;background:linear-gradient(135deg,#007BFF,#00D4FF);
      border-bottom-right-radius:6px;box-shadow:0 3px 10px rgba(0,122,255,.28)
    }
    .ai-msg{
      align-self:flex-start;color:#222;background:#eef3ff;border:1px solid #dbe1ff;border-bottom-left-radius:6px
    }

    /* Barra input */
    .chat-input{display:flex;align-items:center;gap:8px;border-top:1px solid #ddd;background:#fff;padding:10px}
    .chat-input .input-wrap{flex:1;position:relative}
    .chat-input input{
      width:100%;border:none;background:transparent;padding:14px 44px 14px 14px;outline:none;color:#333;font-size:1rem
    }
    .chat-input .right-actions{display:flex;gap:8px}
    .chat-input button{
      border:none;cursor:pointer;font-size:1.1rem;color:#fff;border-radius:12px;
      padding:12px 16px;display:inline-flex;align-items:center;justify-content:center;transition:.25s
    }

    /* Microfono */
    #voiceBtn{background:#28a745}
    #voiceBtn:hover{background:#1e7e34}
    #voiceBtn.voice-active{
      background:#dc3545;animation:pulse 1.2s infinite
    }
    @keyframes pulse{
      0%{box-shadow:0 0 0 0 rgba(220,53,69,.45)}
      70%{box-shadow:0 0 0 14px rgba(220,53,69,0)}
      100%{box-shadow:0 0 0 0 rgba(220,53,69,0)}
    }

    /* Invia */
    #sendBtn{background:linear-gradient(135deg,#007BFF,#00D4FF)}
    #sendBtn:hover{background:linear-gradient(135deg,#0056b3,#0099cc)}

    /* Stato voce */
    .voice-status{
      font-size:.92rem;color:#666;background:#fafafa;border-top:1px dashed #eee;
      padding:8px 12px;display:none
    }
    .voice-status.show{display:block}

    /* Piccola animazione d‚Äôingresso */
    @keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
  </style>
</head>

<body>
  <canvas id="fireworksCanvas"></canvas>

  <!-- Loader -->
  <div id="loader-wrapper"><div id="loader-text">GioSpezia</div></div>

  <!-- Back to Top -->
  <button id="back-to-top" aria-label="Torna su"><i class="fas fa-chevron-up"></i></button>

  <!-- Cookie Banner -->
  <div id="cookieBox" class="cookie-banner" style="display:none;">
    <button id="closeBanner" aria-label="Chiudi cookie banner"><i class="fa-solid fa-xmark"></i></button>
    <div class="cookie-content">
      <h3>üç™ Questo sito utilizza i cookie</h3>
      <p>Miglioriamo la tua esperienza. Puoi accettare tutti o personalizzare le preferenze.</p>
      <div class="cookie-buttons">
        <button id="acceptCookies">Accetta Tutto</button>
        <button id="customizeCookies" class="outline">Personalizza</button>
      </div>
      <div id="cookieManage" class="cookie-manage">
        <h4>üéõÔ∏è Gestisci Preferenze</h4>
        <label><input type="checkbox" id="analytics"/> Cookie Analitici</label><br/>
        <label><input type="checkbox" id="marketing"/> Cookie Marketing</label><br/>
        <button id="savePreferences">Salva Preferenze</button>
      </div>
    </div>
  </div>

  <!-- Bottone per riaprire il banner -->
  <button id="reopenButton" style="display:none;position:fixed;bottom:20px;left:20px;z-index:9999;">üç™ Cookie</button>

  <!-- Contenuto principale -->
  <div id="content" style="display:none;">
    <header class="navbar">
      <div class="container">
        <div class="logo"><a href="https://giospezia.it">GioSpezia</a></div>
        <nav>
          <ul class="nav-links">
            <li><a href="index.html" class="nav-link">Home</a></li>
            <li><a href="social.html" class="nav-link">Social</a></li>
            <li><a href="staffexp.html" class="nav-link">Staff Experience</a></li>
            <li><a href="eventi.html" class="nav-link">Event</a></li>
            <li><a href="jarvis.html" class="nav-link active">J.A.R.V.I.S</a></li>
            <li><a href="contact.html" class="nav-link">Contact Me</a></li>
          </ul>
        </nav>
        <div class="hamburger" aria-label="Apri menu"><span></span><span></span><span></span></div>
      </div>
    </header>

    <!-- ====== SEZIONE J.A.R.V.I.S ====== -->
    <section class="jarvis-section">
      <div class="jarvis-header">
        <h2>J.A.R.V.I.S</h2>
        <p>La tua futura AI personale</p>
      </div>

      <div class="chat-box" role="region" aria-label="Chat J.A.R.V.I.S">
        <div class="chat-messages" id="chatMessages">
          <div class="ai-msg message">üëã Ciao! Sono J.A.R.V.I.S. Come posso aiutarti oggi?</div>
        </div>

        <div class="chat-input">
          <div class="input-wrap">
            <input type="text" id="userInput" placeholder="Scrivi un messaggio..." autocomplete="off" aria-label="Scrivi un messaggio"/>
          </div>
          <div class="right-actions">
            <button id="voiceBtn" aria-label="Dettatura vocale (clicca per avviare/fermare)"><i class="fas fa-microphone"></i></button>
            <button id="sendBtn" aria-label="Invia messaggio"><i class="fas fa-paper-plane"></i></button>
          </div>
        </div>

        <div id="voiceStatus" class="voice-status" aria-live="polite"></div>
      </div>
    </section>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <p>&copy; 2024 Giovanni Spezia. Tutti i diritti riservati.</p>
        <div class="social-icons">
          <a href="https://www.instagram.com/giospezia06/" target="_blank" rel="noopener"><i class="fab fa-instagram"></i></a>
          <a href="https://www.youtube.com/@GioSpezia" target="_blank" rel="noopener"><i class="fab fa-youtube"></i></a>
          <a href="https://www.linkedin.com/in/giovanni-spezia-71577124b/" target="_blank" rel="noopener"><i class="fab fa-linkedin-in"></i></a>
          <a href="https://github.com/giovannispezia" target="_blank" rel="noopener"><i class="fab fa-github"></i></a>
        </div>
        <div class="quick-contact">
          <div><i class="fas fa-envelope"></i> <a href="mailto:gio@giospezia.it">gio@giospezia.it</a></div>
        </div>
        <div class="privacy-policy">
          <a href="privacy.html" class="privacy-link">Informativa sulla privacy</a>
        </div>
      </div>
    </div>
  </footer>

  <!-- Script generali del sito -->
  <script src="script.js"></script>

  <!-- ====== LOGICA CHAT + VOCE ====== -->
  <script>
    // Elementi base
    const chatMessages = document.getElementById("chatMessages");
    const userInput     = document.getElementById("userInput");
    const sendBtn       = document.getElementById("sendBtn");
    const voiceBtn      = document.getElementById("voiceBtn");
    const voiceStatus   = document.getElementById("voiceStatus");

    // Utility: aggiunge un messaggio alla chat
    function appendMessage(text, type){ // type: 'user' | 'ai'
      const el = document.createElement("div");
      el.classList.add(type === "user" ? "user-msg" : "ai-msg", "message");
      el.textContent = text;
      chatMessages.appendChild(el);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // Invia messaggio (manuale)
    function sendMessage(){
      const text = userInput.value.trim();
      if(!text) return;
      appendMessage(text, "user");
      userInput.value = "";

      // Risposta dimostrativa J.A.R.V.I.S
      setTimeout(()=> appendMessage("üîß Questa √® una risposta dimostrativa di J.A.R.V.I.S.", "ai"), 700);
    }

    // Click invio
    sendBtn.addEventListener("click", sendMessage);
    // Invio con Enter
    userInput.addEventListener("keydown", (e)=>{
      if(e.key === "Enter"){
        e.preventDefault();
        sendMessage();
      }
    });

    // === Riconoscimento vocale (Web Speech API) ===
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    let recognition = null;
    let listening = false;
    const originalPlaceholder = userInput.placeholder;

    function setVoiceUI(active, text){
      listening = active;
      voiceBtn.classList.toggle("voice-active", active);
      userInput.placeholder = active ? "Ascoltando... parla ora" : originalPlaceholder;
      if(text){
        voiceStatus.textContent = text;
        voiceStatus.classList.add("show");
      }else{
        voiceStatus.classList.remove("show");
        voiceStatus.textContent = "";
      }
    }

    if(SpeechRecognition){
      recognition = new SpeechRecognition();
      recognition.lang = "it-IT";
      recognition.continuous = false;
      recognition.interimResults = false;

      recognition.onstart = () => setVoiceUI(true, "üé§ In ascolto...");
      recognition.onend   = () => setVoiceUI(false, "‚úÖ Registrazione terminata");
      recognition.onerror = (e) => setVoiceUI(false, "‚ö†Ô∏è Errore: " + (e.error || "sconosciuto"));

      recognition.onresult = (event)=>{
        const transcript = event.results[0][0].transcript;
        userInput.value = transcript;   // Non inviamo automaticamente
        setVoiceUI(false, "üìù Testo trascritto. Premi invio per spedire.");
      };

      // Avvio/stop a toggle
      voiceBtn.addEventListener("click", ()=>{
        if(!listening){ recognition.start(); }
        else { recognition.stop(); }
      });
    } else {
      // Disabilita microfono se non supportato
      voiceBtn.disabled = true;
      voiceBtn.title = "Il tuo browser non supporta la dettatura";
      voiceBtn.style.opacity = .6;
      voiceStatus.textContent = "‚ö†Ô∏è Dettatura non supportata su questo browser.";
      voiceStatus.classList.add("show");
    }
  </script>
</body>
</html>
